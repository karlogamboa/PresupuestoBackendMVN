# Lambda-specific configuration
# This profile is activated when running on AWS Lambda

# AWS Lambda Configuration
spring.main.web-application-type=servlet
spring.main.lazy-initialization=true
spring.main.banner-mode=off
spring.jmx.enabled=false

# AWS Configuration for Lambda
aws.region=${/presupuesto/aws/region:${AWS_REGION:us-east-2}}
aws.dynamodb.table.prefix=${/presupuesto/aws/dynamodb/table/prefix:${TABLE_PREFIX:presupuesto-}}

# Lambda doesn't need embedded server configuration
server.port=${/presupuesto/server/port:8080}
server.ssl.enabled=false
server.servlet.context-path=/

# JWT/OAuth2 Configuration (Parameter Store fallback)
spring.security.oauth2.resourceserver.jwt.issuer-uri=${/presupuesto/okta/jwt-issuer-uri:${OKTA_ISSUER_URI:https://trial-6802190.okta.com/oauth2/default}}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${/presupuesto/okta/jwt-issuer-uri:${OKTA_ISSUER_URI:https://trial-6802190.okta.com/oauth2/default}}/v1/keys

# Okta Configuration (Parameter Store fallback)
okta.oauth2.issuer=${/presupuesto/okta/issuer-uri:${OKTA_ISSUER_URI:https://trial-6802190.okta.com/oauth2/default}}
okta.oauth2.client-id=${/presupuesto/okta/client-id:${OKTA_CLIENT_ID:0oasv2pcg4hRbY5YV697}}
okta.oauth2.client-secret=${/presupuesto/okta/client-secret:${OKTA_CLIENT_SECRET:}}
okta.oauth2.audience=${/presupuesto/okta/audience:${OKTA_AUDIENCE:api://default}}
okta.oauth2.fallback-redirect-uri=${/presupuesto/okta/fallback-redirect-uri:${OKTA_FALLBACK_REDIRECT_URI:http://localhost:3000/callback}}

# CORS Configuration (Parameter Store fallback)
cors.allowed-origins=${/presupuesto/cors/allowed-origins:${CORS_ALLOWED_ORIGINS:*}}
cors.allowed-methods=${/presupuesto/cors/allowed-methods:${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}}
cors.allowed-headers=${/presupuesto/cors/allowed-headers:${CORS_ALLOWED_HEADERS:*}}

# Lambda timeout considerations
spring.jpa.defer-datasource-initialization=false
spring.datasource.initialization-mode=never

# Swagger/OpenAPI Configuration for Lambda
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.try-it-out-enabled=true
springdoc.swagger-ui.operations-sorter=method
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.filter=true
springdoc.default-consumes-media-type=application/json
springdoc.default-produces-media-type=application/json
springdoc.show-actuator=false
# Enable Swagger UI for Lambda
springdoc.swagger-ui.disable-swagger-default-url=false

# OpenAPI Server Configuration (Parameter Store fallback)
openapi.development.server.url=${/presupuesto/openapi/development/server/url:http://localhost}
openapi.production.server.url=${/presupuesto/openapi/production/server/url:}
openapi.cloudfront.url=${/presupuesto/openapi/cloudfront/url:}

# Lambda Function URL (will be set by environment variable)
lambda.function.url=${LAMBDA_FUNCTION_URL:}

# Logging configuration for Lambda
logging.level.com.cdc.presupuesto=DEBUG
logging.level.software.amazon.awssdk=INFO
logging.level.org.springframework=${/presupuesto/logging/level/org/springframework:INFO}
logging.level.root=INFO
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
